# 🔗 잔디(JANDI) 웹훅 연동 가이드

## 1. 웹훅 엔드포인트
```
http://10.10.10.183:8080/webhook
```

## 2. 잔디 웹훅 설정 방법

### 2-1. 잔디 관리자 설정
1. 잔디 워크스페이스 관리자로 로그인
2. **설정** → **서비스 연동** → **웹훅 연동** 이동
3. **새 웹훅 만들기** 클릭
4. 웹훅 정보 입력:
   - 이름: `물품운송 자동등록`
   - URL: `http://10.10.10.183:8080/webhook`
   - 메소드: `POST`
5. 저장

### 2-2. 잔디 앱/봇 설정 (자동화)
Zapier나 IFTTT를 통해 잔디 메시지를 자동으로 웹훅으로 전송할 수 있습니다.

## 3. 메시지 형식

### 자동 인식되는 메시지 패턴

#### ✅ 운송 요청 메시지
```
평촌 → 판교 센서 2개 이송 부탁드립니다 @홍길동
광주에서 판교로 노트북 전달 요청드립니다 @김철수
평촌 --> 광주 ML-U 센서 하나 전달해주실 분
```

#### ✅ 전달 수락 메시지
```
제가 전달드리겠습니다
전달하겠습니다
넵 알겠습니다
```

#### ✅ 완료 메시지
```
잘 받았습니다
수령했습니다
물건 잘 받았습니다 감사합니다
```

### 인식되는 키워드
- **위치**: 평촌, 판교, 광주 (생산기술센터, R&D 포함)
- **방향**: →, ->, -->>, 에서~로
- **물품**: 센서, 노트북, 박스, ML-U, SL-U, 보드
- **이름**: @이름(한글명) 형식

## 4. 웹훅 JSON 형식

### 요청 형식 (Request)
```json
{
  "message": "평촌 → 판교 센서 이송 부탁드립니다 @홍길동",
  "timestamp": "2025-09-23T10:00:00",
  "sender": "Paul",
  "channel": "물품운송",
  "item": "센서"
}
```

### 응답 형식 (Response)
```json
{
  "success": true,
  "record": {
    "id": 8,
    "request_date": "2025-09-23",
    "applicant": "Paul",
    "transporter": "",
    "from_location": "평촌",
    "to_location": "판교",
    "item": "센서",
    "applicant_amount": 5000,
    "transporter_amount": 5000,
    "status": "진행중"
  }
}
```

## 5. 포인트 정책

| 경로 | 요청자 | 전달자 |
|------|--------|--------|
| 판교 ↔ 평촌 | 5,000P | 5,000P |
| 광주 ↔ 판교 | 5,000P | 10,000P |
| 광주 ↔ 평촌 | 5,000P | 10,000P |

## 6. 수동 테스트 (curl)

### Windows PowerShell
```powershell
$body = @{
    message = "평촌 → 판교 센서 이송 부탁드립니다 @홍길동"
    timestamp = (Get-Date -Format "yyyy-MM-ddTHH:mm:ss")
    item = "센서"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://10.10.10.183:8080/webhook" `
    -Method POST `
    -ContentType "application/json" `
    -Body $body
```

### Linux/Mac Terminal
```bash
curl -X POST http://10.10.10.183:8080/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "message": "평촌 → 판교 센서 이송 부탁드립니다 @홍길동",
    "timestamp": "2025-09-23T10:00:00",
    "item": "센서"
  }'
```

## 7. 자동화 시나리오

### 시나리오 1: 운송 요청 → 완료
1. **요청**: "평촌 → 판교 센서 이송 부탁드립니다 @Paul"
2. **수락**: "제가 전달하겠습니다 @James"
3. **완료**: "잘 받았습니다 감사합니다"
4. **결과**:
   - Paul: +5,000P (요청자)
   - James: +5,000P (전달자)
   - 상태: 완료

### 시나리오 2: 광주 장거리 운송
1. **요청**: "광주에서 판교로 ML-U 센서 전달 요청 @Jake"
2. **수락**: "내일 전달드리겠습니다 @Anna"
3. **완료**: "수령했습니다"
4. **결과**:
   - Jake: +5,000P (요청자)
   - Anna: +10,000P (전달자, 장거리)
   - 상태: 완료

## 8. 문제 해결

### Q: 메시지가 인식되지 않아요
- 위치명이 정확한지 확인 (평촌, 판교, 광주)
- 화살표나 방향 표시가 있는지 확인
- 이름 형식이 @영문명(한글명) 인지 확인

### Q: 포인트가 잘못 계산되었어요
- 관리자 페이지에서 수동으로 조정 가능
- /admin_login 접속 → 포인트 수동 조정

### Q: 웹훅이 동작하지 않아요
- 서버 상태 확인: http://10.10.10.183:8080
- 네트워크 연결 확인
- 방화벽 설정 확인 (포트 8080)

## 9. 연락처
- 서버 관리자: IT팀
- 포인트 문의: 인사팀
- 기술 지원: 개발팀